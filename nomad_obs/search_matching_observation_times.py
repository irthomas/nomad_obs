# -*- coding: utf-8 -*-
"""
Created on Mon Apr  7 12:37:46 2025

@author: iant

FIND OCCULTATIONS CLOSEST TO EACH UTC TIME INPUT

THE ORBITLIST NEEDS TO BE GENERATED BY RUN_PLANNING FIRST
"""

from datetime import datetime, timedelta

ORBITLIST_DT_FORMAT = "%Y %b %d %H:%M:%S"
SEARCH_DT_FORMAT = "%Y %b %d %H:%M:%S"  # format of list below


search_for = "occultation"

list_types = ["NOMAD"]
# list_types = ["NOMAD", "ACS", "N/A"]

# verbosity = 0  # just print prime pointing e.g. for copying into spreadsheets
verbosity = 1  # print full statement e.g. for adding manually to Excel


search_times = [
    # "2025 JUN 12 00:02:45",
    # "2025 JUN 12 21:40:06",
    # "2025 JUN 12 23:38:00",
    # "2025 JUN 13 23:13:14",
    # "2025 JUN 14 01:11:09",
    # "2025 JUN 14 22:48:25",
    # "2025 JUN 15 00:46:19",
    # "2025 JUN 16 00:21:29",
    # "2025 JUN 16 23:56:35",
    # "2025 JUN 17 01:54:29",
    # "2025 JUN 17 23:31:40",
    # "2025 JUN 18 01:29:33",
    # "2025 JUN 19 01:04:34",
    # "2025 JUN 19 03:02:59",
    # "2025 JUN 20 00:39:33",
    # "2025 JUN 20 02:37:26",
    # "2025 JUN 21 00:14:31",
    # "2025 JUN 21 02:12:23",
    # "2025 JUN 22 01:47:18",
    # "2025 JUN 22 03:45:23",
    # "2025 JUN 23 01:22:12",
    # "2025 JUN 23 03:20:04",
    # "2025 JUN 24 00:57:02",
    # "2025 JUN 24 02:54:54",
    # "2025 JUN 25 02:29:42",
    # "2025 JUN 25 04:27:52",
    # "2025 JUN 26 02:04:25",
    # "2025 JUN 26 04:02:17",
    # "2025 JUN 27 01:39:06",
    # "2025 JUN 27 03:36:57",
    # "2025 JUN 28 03:11:33",
    # "2025 JUN 28 05:09:23",
    # "2025 JUN 29 02:46:04",
    # "2025 JUN 29 04:43:54",
    # "2025 JUN 30 02:20:31",
    # "2025 JUN 30 04:18:21",
    # "2025 JUL 01 03:52:42",
    # "2025 JUL 01 05:50:31",
    # "2025 JUL 02 03:26:57",
    # "2025 JUL 02 05:24:46",
    # "2025 JUL 03 04:58:51",
    # "2025 JUL 03 06:57:23",
    # "2025 JUL 04 04:32:46",
    # "2025 JUL 04 06:30:33",
    # "2025 JUL 31 07:42:56",
    # "2025 AUG 01 07:16:39",
    # "2025 AUG 01 09:14:26",
    # "2025 AUG 02 06:50:36",
    # "2025 AUG 02 08:48:24",

    # "2025 SEP 27 16:07:02",
    # "2025 SEP 27 20:03:01",
    # "2025 SEP 28 17:41:08",
    # "2025 SEP 28 21:37:04",
    # "2025 SEP 29 15:19:07",
    # "2025 SEP 29 19:15:08",
    # "2025 SEP 29 23:11:02",
    # "2025 SEP 30 16:53:01",
    # "2025 SEP 30 20:48:59",
    # "2025 Oct 01 18:26:49",
    # "2025 Oct 01 22:22:44",
    # "2025 Oct 02 20:00:32",
    # "2025 Oct 02 23:56:24",
    # "2025 Oct 03 21:34:08",
    # "2025 Oct 04 01:30:00",
    # "2025 Oct 04 19:11:48",
    # "2025 Oct 07 23:52:09",
    # "2025 Oct 08 03:47:59",
    # "2025 Oct 09 01:25:29",
    # "2025 Oct 09 05:21:19",
    # "2025 Oct 10 02:58:45",
    # "2025 Oct 10 06:54:37",
    # "2025 Oct 11 04:31:59",
    # "2025 Oct 11 08:27:53",
    # "2025 Oct 12 02:09:23",
    # "2025 Oct 12 06:05:12",
    # "2025 Oct 12 10:01:08",
    # "2025 Oct 13 03:42:33",
    # "2025 Oct 13 07:38:23",
    # "2025 Oct 13 11:34:21",
    # "2025 Oct 14 05:15:42",
    # "2025 Oct 14 09:11:35",
    # "2025 Oct 14 13:07:32",
    # "2025 Oct 15 06:48:50",
    # "2025 Oct 15 10:44:45",
    # "2025 Oct 15 14:40:40",
    # "2025 Oct 16 08:21:57",
    # "2025 Oct 16 12:17:53",
    # "2025 Oct 17 09:55:02",
    # "2025 Oct 17 13:50:59",
    # "2025 Oct 17 19:44:39",
    # "2025 Oct 17 23:40:36",
    # "2025 Oct 18 11:28:06",
    # "2025 Oct 18 15:24:01",
    # "2025 Oct 18 21:17:42",
    # "2025 Oct 19 01:13:38",
    # "2025 Oct 19 13:01:09",
    # "2025 Oct 19 16:57:02",
    # "2025 Oct 19 22:50:44",
    # "2025 Oct 20 02:46:39",
    # "2025 Oct 20 14:34:10",
    # "2025 Oct 20 18:29:59",
    # "2025 Oct 21 16:07:10",
    # "2025 Oct 21 20:02:55",
    # "2025 Oct 22 17:40:07",
    # "2025 Oct 22 21:35:51",
    # "2025 Oct 23 15:17:12",
    # "2025 Oct 23 19:13:02",
    # "2025 Oct 23 23:08:48",
    # "2025 Oct 24 16:50:09",
    # "2025 Oct 24 20:45:55",
    # "2025 Oct 25 18:23:02",
    # "2025 Oct 25 22:18:45",
    # "2025 Oct 26 19:55:52",
    # "2025 Oct 26 23:51:35",
    # "2025 Oct 27 17:32:51",
    # "2025 Oct 27 21:28:38",
    # "2025 Oct 28 01:24:25",

    # "2025 Oct 25 18:23:02",
    # "2025 Oct 25 22:18:45",
    # "2025 Oct 26 19:55:52",
    # "2025 Oct 26 23:51:35",
    # "2025 Oct 27 17:32:51",
    # "2025 Oct 27 21:28:38",
    # "2025 Oct 28 01:24:25",

    "2026 FEB 06 02:26:50",
    "2026 FEB 06 06:22:40",
    "2026 FEB 07 00:04:06",
    "2026 FEB 07 04:00:02",
    "2026 FEB 07 07:55:50",
    "2026 FEB 07 17:45:35",
    "2026 FEB 07 21:41:21",
    "2026 FEB 08 01:37:19",
    "2026 FEB 08 05:33:12",
    "2026 FEB 08 07:31:06",
    "2026 FEB 08 09:29:00",
    "2026 FEB 08 11:26:55",
    "2026 FEB 08 15:22:51",
    "2026 FEB 08 19:18:43",
    "2026 FEB 08 23:14:32",
    "2026 FEB 09 03:10:29",
    "2026 FEB 09 07:06:20",
    "2026 FEB 09 09:04:13",
    "2026 FEB 09 11:02:08",
    "2026 FEB 09 13:00:05",
    "2026 FEB 09 14:58:03",
    "2026 FEB 09 16:56:02",
    "2026 FEB 09 20:51:50",
    "2026 FEB 10 00:47:42",
    "2026 FEB 10 04:43:38",
    "2026 FEB 10 08:39:27",
    "2026 FEB 10 10:37:21",
    "2026 FEB 10 12:35:17",
    "2026 FEB 10 14:33:15",
    "2026 FEB 10 16:31:13",
    "2026 FEB 10 18:29:10",
    "2026 FEB 10 22:24:56",
    "2026 FEB 11 02:20:53",
    "2026 FEB 11 06:16:47",
    "2026 FEB 11 10:12:35",
    "2026 FEB 11 12:10:29",
    "2026 FEB 11 14:08:26",
    "2026 FEB 11 16:06:25",
    "2026 FEB 11 18:04:23",
    "2026 FEB 11 20:02:18",
    "2026 FEB 11 23:58:05",
    "2026 FEB 12 03:54:02",
    "2026 FEB 12 07:49:54",
    "2026 FEB 12 11:45:42",
    "2026 FEB 12 13:43:38",
    "2026 FEB 12 15:41:36",
    "2026 FEB 12 17:39:35",
    "2026 FEB 12 19:37:31",
    "2026 FEB 12 21:35:25",
    "2026 FEB 13 01:31:15",
    "2026 FEB 13 05:27:12",
    "2026 FEB 13 09:23:02",
    "2026 FEB 13 13:18:51",
    "2026 FEB 13 15:16:48",
    "2026 FEB 13 17:14:46",
    "2026 FEB 13 19:12:44",
    "2026 FEB 13 21:10:38",
    "2026 FEB 13 23:08:30",
    "2026 FEB 14 03:04:25",
    "2026 FEB 14 07:00:20",
    "2026 FEB 14 10:56:08",
    "2026 FEB 14 14:51:59",
    "2026 FEB 14 16:49:58",
    "2026 FEB 14 18:47:56",
    "2026 FEB 14 20:45:52",
    "2026 FEB 14 22:43:45",
    "2026 FEB 15 00:41:38",
    "2026 FEB 15 04:37:35",
    "2026 FEB 15 08:33:28",
    "2026 FEB 15 12:29:15",
    "2026 FEB 15 16:25:08",
    "2026 FEB 15 18:23:06",
    "2026 FEB 15 20:21:03",
    "2026 FEB 15 22:18:57",
    "2026 FEB 16 00:16:49",
    "2026 FEB 16 02:14:46",
    "2026 FEB 16 06:10:43",
    "2026 FEB 16 10:06:34",
    "2026 FEB 16 14:02:22",
    "2026 FEB 16 17:58:17",
    "2026 FEB 16 19:56:15",
    "2026 FEB 16 21:54:11",
    "2026 FEB 16 23:52:03",
    "2026 FEB 17 01:49:57",
    "2026 FEB 17 07:43:51",
    "2026 FEB 17 11:39:39",
    "2026 FEB 17 17:33:27",
    "2026 FEB 17 19:31:25",
    "2026 FEB 17 21:29:22",
    "2026 FEB 17 23:27:15",
    "2026 FEB 18 01:25:08",
    "2026 FEB 18 05:21:04",
    "2026 FEB 18 09:16:58",
    "2026 FEB 18 13:12:46",
    "2026 FEB 18 17:08:38",
    "2026 FEB 18 19:06:36",
    "2026 FEB 18 21:04:34",
    "2026 FEB 18 23:02:29",
    "2026 FEB 19 01:00:21",
    "2026 FEB 19 02:58:16",
    "2026 FEB 19 06:54:13",
    "2026 FEB 19 10:50:05",
    "2026 FEB 19 14:45:53",
    "2026 FEB 19 18:41:47",
    "2026 FEB 19 20:39:46",
    "2026 FEB 19 22:37:42",
    "2026 FEB 20 00:35:35",
    "2026 FEB 20 02:33:28",
    "2026 FEB 20 04:31:27",
    "2026 FEB 20 08:27:24",
    "2026 FEB 20 12:23:13",
    "2026 FEB 20 16:19:03",
    "2026 FEB 20 20:14:58",
    "2026 FEB 20 22:12:56",
    "2026 FEB 21 00:10:51",
    "2026 FEB 21 02:08:43",
    "2026 FEB 21 04:06:39",
    "2026 FEB 21 06:04:38",
    "2026 FEB 21 10:00:33",
    "2026 FEB 21 13:56:22",
    "2026 FEB 21 17:52:14",
    "2026 FEB 21 21:48:11",
    "2026 FEB 21 23:46:07",
    "2026 FEB 22 01:44:00",
    "2026 FEB 22 03:41:54",
    "2026 FEB 22 05:39:52",
    "2026 FEB 22 07:37:52",
    "2026 FEB 22 11:33:45",
    "2026 FEB 22 15:29:33",
    "2026 FEB 22 19:25:27",
    "2026 FEB 22 23:21:22",
    "2026 FEB 23 01:19:17",
    "2026 FEB 23 03:17:09",
    "2026 FEB 23 05:15:06",
    "2026 FEB 23 07:13:06",
    "2026 FEB 23 09:11:05",
    "2026 FEB 23 13:06:56",
    "2026 FEB 23 17:02:45",
    "2026 FEB 23 20:58:41",
    "2026 FEB 23 22:56:39",
    "2026 FEB 24 00:54:35",
    "2026 FEB 24 02:52:28",
    "2026 FEB 24 04:50:23",
    "2026 FEB 24 06:48:22",
    "2026 FEB 24 10:44:19",
    "2026 FEB 24 14:40:08",
    "2026 FEB 24 18:35:59",
    "2026 FEB 24 22:31:55",
    "2026 FEB 25 00:29:52",
    "2026 FEB 25 02:27:46",
    "2026 FEB 25 04:25:39",
    "2026 FEB 25 06:23:38",
    "2026 FEB 25 08:21:38",
    "2026 FEB 25 12:17:32",
    "2026 FEB 25 16:13:21",
    "2026 FEB 25 20:09:15",
    "2026 FEB 26 00:05:12",
    "2026 FEB 26 02:03:08",
    "2026 FEB 26 04:01:00",
    "2026 FEB 26 05:58:56",
    "2026 FEB 26 07:56:55",
    "2026 FEB 26 09:54:55",
    "2026 FEB 26 13:50:47",
    "2026 FEB 26 17:46:37",
    "2026 FEB 26 21:42:32",
    "2026 FEB 26 23:40:31",
    "2026 FEB 27 01:38:28",
    "2026 FEB 27 03:36:22",
    "2026 FEB 27 05:34:16",
    "2026 FEB 27 07:32:15",
    "2026 FEB 27 11:28:14",
    "2026 FEB 27 15:24:05",
    "2026 FEB 27 19:19:57",
    "2026 FEB 27 23:15:54",
    "2026 FEB 28 01:13:52",
    "2026 FEB 28 03:11:48",
    "2026 FEB 28 05:09:41",
    "2026 FEB 28 07:07:37",
    "2026 FEB 28 13:01:35",
    "2026 FEB 28 16:57:26",

]


for search_time in search_times:

    etTime = datetime.strptime(search_time, SEARCH_DT_FORMAT)

    found = False

    for orbit in orbitList:

        if "ingress" in orbit.keys():
            utcStart = orbit["ingress"]["utcStart"]
            utcEnd = orbit["ingress"]["utcEnd"]

            etStart = datetime.strptime(utcStart, ORBITLIST_DT_FORMAT) - timedelta(seconds=10)
            etEnd = datetime.strptime(utcEnd, ORBITLIST_DT_FORMAT) + timedelta(seconds=10)

            found = True
            if etStart < etTime and etTime < etEnd:
                orbitNumber = orbit["orbitNumber"]
                prime = orbit["ingress"]["primeInstrument"]
                if prime in list_types:
                    if verbosity == 0:
                        print(prime)
                    else:
                        print("Match found: %s ingress orbit %i (%s) - %i row in Excel" % (prime, orbitNumber, search_time, orbitNumber+1))

        if "egress" in orbit.keys():
            utcStart = orbit["egress"]["utcStart"]
            utcEnd = orbit["egress"]["utcEnd"]

            etStart = datetime.strptime(utcStart, ORBITLIST_DT_FORMAT) - timedelta(seconds=10)
            etEnd = datetime.strptime(utcEnd, ORBITLIST_DT_FORMAT) + timedelta(seconds=10)

            found = True
            if etStart < etTime and etTime < etEnd:
                orbitNumber = orbit["orbitNumber"]
                prime = orbit["egress"]["primeInstrument"]
                if prime in list_types:
                    if verbosity == 0:
                        print(prime)
                    else:
                        print("Match found: %s egress orbit %i (%s) - %i row in Excel" % (prime, orbitNumber, search_time, orbitNumber+1))

    if not found:
        print("Not found: %s" % search_time)
